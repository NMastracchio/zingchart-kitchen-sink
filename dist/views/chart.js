define(["require","exports","module","backbone","collections/charts","../models/info"],function(e,t,n){var r=e("backbone"),i=e("collections/charts"),s=e("../models/info"),o=r.View.extend({el:"#zc-current-view",file:null,coll:null,template:_.template($("#ChartTemplate").html()),initialize:function(e){var t=this;this.infoModel=new s,this.file=e.file,this.coll=new i,$.ajax(t.file,{async:!1}).done(function(e){t.coll.add(e),t.render()})},events:{"change .aspect-select":"updateAspect","click a":"updateChart",'change [id^="mixedChart"]':"changeMixed"},destroyCharts:function(){this.coll.each(function(e){var t=e.get("render").attributes.id;zingchart.exec(t,"destroy")})},render:function(){var e=$("#theme-picker").val();this.infoModel.set("theme",e),this.$el.html(this.template({charts:this.coll.toJSON(),info:this.infoModel.toJSON()})),this.coll.each(function(e){var t=e.get("render").attributes,n=e.attributes.script;if(n)$.getScript(n,function(){var e=$("#theme-picker").val();if(t.data){if(t.data.graphset&&t.data.graphset.length>=1)for(var n=0;n<t.data.graphset.length;n++)t.data.graphset[n].theme=e;else t.data.theme=e;zingchart.render(t)}});else{var r=$("#theme-picker").val();if(t.data){if(t.data.graphset&&t.data.graphset.length>=1)for(var i=0;i<t.data.graphset.length;i++)t.data.graphset[i].theme=r;else t.data.theme=r;zingchart.render(t)}}});var t=0,n=0;return this.coll.each(function(e){e.attributes.render.attributes.data&&t++}),t||window.setTimeout(function(){$("#loading-shutter").animate({top:"-=1080"},500)},1e3),zingchart.load=function(){n++,n==t&&$("#loading-shutter").animate({top:"-=1080"},500)},this},unbindEvents:function(){this.undelegateEvents()},updateAspect:function(e){var t=$(e.target).attr("id").split("-")[0],n=$(e.target).val(),r=this.coll.find(function(e){return e.get("render").get("id")==t});if(r)var i=_.clone(r.get("render").get("data")),s=_.clone(r.get("states"));switch(t){case"pieChart":n=="nestedpie"?(i=s.nestedpie2d.data,s.currentType="nestedpie2d"):n=="ring"?s.is3d?(i=s.ring3d.data,s.currentType="ring3d"):(console.log("ring2d"),i=s.ring2d.data,s.currentType="ring2d"):s.is3d?(i=s.pie3d.data,s.currentType="pie3d"):(i=s.pie2d.data,s.currentType="pie2d");break;case"treemapVis":i.options={"split-type":n};break;case"wordcloudVis":i.options.aspect=n;break;case"toggleAction":i.legend["toggle-action"]=n;break;case"legendPositioning":n=="top"||n=="middle"||n=="bottom"?i.legend["vertical-align"]=n:i.legend.align=n;break;case"radarChart":n=="mixed"?i.series=s.altSeries:i.series=s.ogSeries;default:i&&(i.plot?i.plot.aspect=n:i.plot={aspect:n})}r.get("render").set("data",i),r.set("states",i),r.get("render").trigger("change")},updateChart:function(e){var t=$(e.target).attr("id").split("-"),n=t[0],r=t[1],i=this.coll.find(function(e){return e.get("render").get("id")==n});if(i)var s=_.clone(i.get("render").get("data")),o=_.clone(i.get("states"));switch(r){case"3d":if(o.is3d)if(n=="pieChart"){var u=o.currentType;switch(u){case"pie3d":s=o.pie2d.data,o.currentType="pie2d";break;case"ring3d":s=o.ring2d.data,o.currentType="ring2d";break;case"nestedpie3d":s=o.nestedpie2d.data,o.currentType="nestedpie2d"}}else s.type=s.type.slice(0,s.type.length-2);else if(n=="pieChart"){var u=o.currentType;switch(u){case"pie2d":s=o.pie3d.data,o.currentType="pie3d";break;case"ring2d":s=o.ring3d.data,o.currentType="ring3d";break;case"nestedpie2d":s=o.nestedpie3d.data,o.currentType="nestedpie3d"}}else s.type+="3d";o.is3d=!o.is3d;break;case"rotate":o.isRotated?s.type=o.orientations[0]:s.type=o.orientations[1],o.isRotated=!o.isRotated;break;case"markers":o.currentMarker!=o.markers.length-1?(o.currentMarker++,s.plot.marker=o.markers[o.currentMarker]):(o.currentMarker=0,s.plot.marker=o.markers[o.currentMarker]);break;case"stack":o.stacktype?s["stack-type"]=o.stacktypes[0]:s["stack-type"]=o.stacktypes[1],o.stacktype=!o.stacktype}i.set("states",o),i.get("render").set("data",s),i.get("render").trigger("change")},changeMixed:function(e){var t=$(e.target).attr("id").split("-"),n=t[0],r=t[1],i=$(e.target).val();zingchart.exec(n,"modifyplot",{plotid:r,data:{type:i}})}});n.exports=o});